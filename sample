from textblob import TextBlob
import pandas as pd
from datetime import datetime
import matplotlib.pyplot as plt

# ① 日記を入力
diary = input("今日の日記を入力してください：\n")

# ② 感情分析
blob = TextBlob(diary)
polarity = blob.sentiment.polarity  # -1（ネガティブ）〜 +1（ポジティブ）

# ③ 結果を保存
entry = {
    "date": datetime.now().strftime("%Y-%m-%d"),
    "diary": diary,
    "polarity": polarity
}

try:
    df = pd.read_csv("emotion_diary.csv")
except FileNotFoundError:
    df = pd.DataFrame(columns=["date", "diary", "polarity"])

df = pd.concat([df, pd.DataFrame([entry])], ignore_index=True)
df.to_csv("emotion_diary.csv", index=False)

# ④ グラフ表示
plt.plot(pd.to_datetime(df["date"]), df["polarity"], marker='o')
plt.title("感情の推移")
plt.xlabel("日付")
plt.ylabel("ポジティブ度")
plt.grid(True)
plt.show()
